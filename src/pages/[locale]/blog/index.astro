---
import { useTranslations } from '@/i18n'
import { getCollection } from 'astro:content'
import { getRelativeLocaleUrl } from 'astro:i18n'
import { Icon } from 'astro-icon/components'
import BaseLayout from "@/layouts/BaseLayout.astro"
import Navigation from "@/components/global/Navigation.astro"
import FormattedDate from '@/components/global/FormattedDate.astro'
import { getFormattedDate } from '@/libs/utils'
import { locales } from '@/i18n'
import Footer from "@/components/global/Footer.astro"

export const prerender = true;
export async function getStaticPaths() {
	return Object.entries(locales).map(([locale, label]) => ({
		params: { locale }
	}))
}

const { locale } = Astro.params
const t = useTranslations(locale)

const metadata = {
    robots: { index: false, },
}

const posts = ((await getCollection('blog', ({ id }) => { return id.startsWith(locale + '/')}))).sort(
	(a, b) => a.data.publishedTime.valueOf() - b.data.publishedTime.valueOf()
).map(post => {
	const [locale, ...slug] = post.slug.split('/')
	return {
		...post,
		locale,
		slug: slug.join('/'),
	}
})

const tags = Array.from(new Set(posts.flatMap(post => post.data.tags))).sort()
---

<BaseLayout metadata={metadata}>
  <Navigation />
    <div class="w-full mx-auto md:px-12 px-8 max-w-7xl lg:px-16 py-8 sm:py-16 lg:py-20 hidden">
      <h1 class="font-bold font-heading text-4xl md:text-5xl leading-tighter tracking-tighter">
	  	{t('menu.blog')}
      </h1>
    </div>
	<section class="text-primary body-font w-full mx-auto md:px-12 px-8 max-w-7xl lg:px-16 py-8 sm:py-16 lg:py-20">
		<div class="container px-5 mx-auto">
			<div class="flex flex-wrap -m-4">
				<div class="p-4 lg:w-1/5 md:w-1/3 hidden md:flex">
					<nav class="-mx-3 space-y-3 ">
						<div class="flex items-center justify-between">
							<h2 class="text-base font-semibold">{t('menu.tags')}</h2>
						</div>
						{
							tags.map((tag) => (
								<a class="flex items-center px-2 py-2 text-link hover:text-accent" 
								href={getRelativeLocaleUrl(locale, `/blog/tag/${tag}/`)}>
									<span class="mx-2 text-sm font-medium">{tag}</span>
								</a>
							))
						}
					</nav>
				</div>
				<div class="p-4 lg:w-4/5 md:w-2/3">
					<div class="flex flex-wrap -m-4">
						{
							posts.map((post) => (
								<div class="p-4 md:w-1/2">
									<div class="h-full border-2 border-primary-lighter border-opacity-10 rounded-lg overflow-hidden">
											<a href={getRelativeLocaleUrl(locale, `/blog/${post.slug}/`)}>
												<img class="lg:h-48 md:h-36 w-full object-cover object-center" src={post.data.heroImage} alt={post.data.title} />
											</a>
											<div class="p-6">
												<a href={getRelativeLocaleUrl(locale, `/blog/${post.slug}/`)}>
													<h2 class="tracking-widest text-xs title-font font-medium text-primary-lighter mb-1">{getFormattedDate(post.data.publishedTime)}</h2>
													<h1 class="title-font text-lg font-medium text-primary mb-3">{post.data.title}</h1>
													<p class="leading-relaxed mb-3 text-primary-light">{post.data.description}</p>
												</a>
												<div class="flex items-center flex-wrap ">
													<a href={getRelativeLocaleUrl(locale, `/blog/${post.slug}/`)}>
														<span class="text-accent hover:text-link cursor inline-flex items-center md:mb-2 lg:mb-0">More
															<Icon name="rightArrow" class="w-4 h-4 ml-2" />
														</span>
													</a>
													<span class="text-primary-lighter mr-3 inline-flex items-center lg:ml-auto md:ml-0 ml-auto leading-none text-sm pr-3 py-1">
														<Icon name="tag" class="w-4 h-4 mr-1" />
														{ post.data.tags.map((tag) =>(<a href={getRelativeLocaleUrl(locale, `/blog/tag/${tag}/`)} class="mr-1 p-1 rounded-full bg-primary-lighter text-default hover:bg-accent">{tag}</a>))}
													</span>
												</div>
											</div>
									</div>
								</div>
							))
						}
					</div>
				</div>
			</div>
		</div>
	</section>
  <Footer />
</BaseLayout>